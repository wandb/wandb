---
kind: PersistentVolume
apiVersion: v1
metadata:
  name: gpu-pod-results-volume
spec:
  storageClassName: gpu-pod-pv
  capacity:
    storage: 1Gi
  accessModes:
    - ReadWriteOnce
  hostPath:
    path: "/tmp"

---
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: gpu-pod-results-volumeclaim
spec:
  storageClassName: gpu-pod-pv
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 100Mi

---
kind: Pod
apiVersion: v1
metadata:
  name: gpu-pod
spec:
  restartPolicy: Never
  containers:
    - name: gpu-sdk
      image: gcr.io/wandb-client-cicd/gpu-sdk:latest
      env:
        - name: WANDB_API_KEY
          value: WANDB_API_KEY_PLACEHOLDER
        - name: AWS_ACCESS_KEY_ID
          value: AWS_ACCESS_KEY_ID_PLACEHOLDER
        - name: AWS_SECRET_ACCESS_KEY
          value: AWS_SECRET_ACCESS_KEY_PLACEHOLDER
        - name: AWS_DEFAULT_REGION
          value: AWS_DEFAULT_REGION_PLACEHOLDER
        - name: GCLOUD_SERVICE_KEY
          value: GCLOUD_SERVICE_KEY_PLACEHOLDER
        - name: GCLOUD_PROJECT
          value: GCLOUD_PROJECT_PLACEHOLDER
      resources:
        limits:
          cpu: 3.999
          nvidia.com/gpu: 2
        requests:
          cpu: 3.5
      volumeMounts:
        - mountPath: "/wandb-store"
          name: gpu-pod-results-volumeclaim-name
  volumes:
    - name: gpu-pod-results-volumeclaim-name
      persistentVolumeClaim:
       claimName: gpu-pod-results-volumeclaim
