fragment FileFragment on File {
  __typename
  id
  name: displayName
  url
  sizeBytes
  storagePath @include(if: true) # Workaround: ensures generated pydantic field defaults to `None`
  mimetype
  updatedAt
  digest
  md5
  directUrl
}

query ArtifactVersionFiles(
  $entityName: String!
  $projectName: String!
  $artifactTypeName: String!
  $artifactName: String!
  $fileNames: [String!]
  $cursor: String
  $perPage: Int = 50
) {
  project(name: $projectName, entityName: $entityName) {
    artifactType(name: $artifactTypeName) {
      artifact(name: $artifactName) {
        files(names: $fileNames, after: $cursor, first: $perPage) {
          pageInfo {
            ...PageInfoFragment
          }
          edges {
            node {
              ...FileFragment
            }
          }
        }
      }
    }
  }
}

query ArtifactCollectionMembershipFiles(
  $entityName: String!
  $projectName: String!
  $artifactName: String!
  $artifactVersionIndex: String!
  $fileNames: [String!]
  $cursor: String
  $perPage: Int = 50
) {
  project(name: $projectName, entityName: $entityName) {
    artifactCollection(name: $artifactName) {
      artifactMembership(aliasName: $artifactVersionIndex) {
        files(names: $fileNames, after: $cursor, first: $perPage) {
          pageInfo {
            ...PageInfoFragment
          }
          edges {
            node {
              ...FileFragment
            }
          }
        }
      }
    }
  }
}

fragment FileWithUrlFragment on File {
  __typename
  name
  directUrl
}

query ArtifactCollectionMembershipFileUrls(
  $entityName: String!
  $projectName: String!
  $artifactName: String!
  $artifactVersionIndex: String!
  $cursor: String
  $perPage: Int
) {
  project(name: $projectName, entityName: $entityName) {
    artifactCollection(name: $artifactName) {
      artifactMembership(aliasName: $artifactVersionIndex) {
        files(after: $cursor, first: $perPage) {
          pageInfo {
            ...PageInfoFragment
          }
          edges {
            node {
              ...FileWithUrlFragment
            }
          }
        }
      }
    }
  }
}

query ArtifactFileUrls($id: ID!, $cursor: String, $perPage: Int) {
  artifact(id: $id) {
    files(after: $cursor, first: $perPage) {
      pageInfo {
        ...PageInfoFragment
      }
      edges {
        node {
          ...FileWithUrlFragment
        }
      }
    }
  }
}
