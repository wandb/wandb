query RegistryVersions(
  $organization: String!
  $registryFilter: JSONString
  $collectionFilter: JSONString
  $artifactFilter: JSONString
  $cursor: String
  $perPage: Int
) {
  organization(name: $organization) {
    orgEntity {
      name
      artifactMemberships(
        projectFilters: $registryFilter
        collectionFilters: $collectionFilter
        filters: $artifactFilter
        after: $cursor
        first: $perPage
      ) {
        ...RegistryVersionConnectionFragment
      }
    }
  }
}

fragment RegistryVersionConnectionFragment on ArtifactCollectionMembershipConnection {
  pageInfo {
    ...PageInfoFragment
  }
  edges {
    node {
      ...ArtifactMembershipFragment
    }
  }
}

query RegistryCollections(
  $organization: String!
  $registryFilter: JSONString
  $collectionFilter: JSONString
  $collectionTypes: [ArtifactCollectionType!]
  $cursor: String
  $perPage: Int
) {
  organization(name: $organization) {
    orgEntity {
      name
      artifactCollections(
        projectFilters: $registryFilter
        filters: $collectionFilter
        collectionTypes: $collectionTypes
        after: $cursor
        first: $perPage
      ) {
        totalCount
        pageInfo {
          ...PageInfoFragment
        }
        edges {
          node {
            ...RegistryCollectionFragment
          }
        }
      }
    }
  }
}

fragment RegistryCollectionFragment on ArtifactCollection {
  __typename
  id
  name
  description
  createdAt
  project {
    ...ProjectInfoFragment
  }
  defaultArtifactType {
    name
  }
  tags {
    edges {
      node {
        ...TagFragment
      }
    }
  }
  aliases {
    edges {
      node {
        ...ArtifactAliasFragment
      }
    }
  }
}

query FetchRegistry($name: String, $entity: String) {
  entity(name: $entity) {
    project(name: $name) {
      ...RegistryFragment
    }
  }
}

query FetchRegistries(
  $organization: String!
  $filters: JSONString
  $cursor: String
  $perPage: Int
) {
  organization(name: $organization) {
    orgEntity {
      name
      projects(filters: $filters, after: $cursor, first: $perPage) {
        ...RegistryConnectionFragment
      }
    }
  }
}

fragment RegistryConnectionFragment on ProjectConnection {
  pageInfo {
    ...PageInfoFragment
  }
  edges {
    node {
      ...RegistryFragment
    }
  }
}

fragment RegistryFragment on Project {
  id
  name
  description
  createdAt
  updatedAt
  access
  allowAllArtifactTypesInRegistry
  artifactTypes(includeAll: true) {
    edges {
      node {
        name
      }
    }
  }
}

# ------------------ Mutations ------------------

mutation RenameRegistry($input: RenameProjectInput!) {
  renameProject(input: $input) {
    inserted
    project {
      name
    }
  }
}

mutation UpsertRegistry($input: UpsertModelInput!) {
  upsertModel(input: $input) {
    inserted
    project {
      ...RegistryFragment
    }
  }
}

mutation DeleteRegistry($id: String!) {
  deleteModel(input: { id: $id }) {
    success
  }
}
