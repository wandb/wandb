query RegistryVersions(
  $organization: String!
  $registryFilter: JSONString
  $collectionFilter: JSONString
  $artifactFilter: JSONString
  $cursor: String
  $perPage: Int
) {
  organization(name: $organization) {
    orgEntity {
      name
      artifactMemberships(
        projectFilters: $registryFilter
        collectionFilters: $collectionFilter
        filters: $artifactFilter
        after: $cursor
        first: $perPage
      ) {
        ...RegistryVersionConnectionFragment
      }
    }
  }
}

fragment RegistryVersionConnectionFragment on ArtifactCollectionMembershipConnection {
  pageInfo {
    ...PageInfoFragment
  }
  edges {
    node {
      ...ArtifactMembershipFragment
    }
  }
}

query RegistryCollections(
  $organization: String!
  $registryFilter: JSONString
  $collectionFilter: JSONString
  $collectionTypes: [ArtifactCollectionType!]
  $cursor: String
  $perPage: Int
) {
  organization(name: $organization) {
    orgEntity {
      name
      artifactCollections(
        projectFilters: $registryFilter
        filters: $collectionFilter
        collectionTypes: $collectionTypes
        after: $cursor
        first: $perPage
      ) {
        ...RegistryCollectionConnectionFragment
      }
    }
  }
}

fragment RegistryCollectionConnectionFragment on ArtifactCollectionConnection {
  totalCount
  pageInfo {
    ...PageInfoFragment
  }
  edges {
    node {
      ...RegistryCollectionFragment
    }
  }
}

fragment RegistryCollectionFragment on ArtifactCollection {
  __typename
  id
  name
  description
  createdAt
  tags {
    edges {
      node {
        ...TagFragment
      }
    }
  }
  project {
    ...ProjectInfoFragment
  }
  defaultArtifactType {
    name
  }
  aliases {
    edges {
      node {
        ...ArtifactAliasFragment
      }
    }
  }
}

query FetchRegistry($name: String, $entityName: String) {
  entity(name: $entityName) {
    project(name: $name) {
      ...RegistryFragment
    }
  }
}

query FetchRegistries(
  $organization: String!
  $filters: JSONString
  $cursor: String
  $perPage: Int
) {
  organization(name: $organization) {
    orgEntity {
      name
      projects(filters: $filters, after: $cursor, first: $perPage) {
        ...RegistryConnectionFragment
      }
    }
  }
}

fragment RegistryConnectionFragment on ProjectConnection {
  pageInfo {
    ...PageInfoFragment
  }
  edges {
    node {
      ...RegistryFragment
    }
  }
}

fragment RegistryFragment on Project {
  id
  allowAllArtifactTypesInRegistry
  artifactTypes(includeAll: true) {
    edges {
      node {
        name
      }
    }
  }
  name
  description
  createdAt
  updatedAt
  access
}

# ------------------ Mutations ------------------

mutation RenameRegistry($entityName: String!, $oldProjectName: String!, $newProjectName: String!) {
  renameProject(
    input: {
      entityName: $entityName
      oldProjectName: $oldProjectName
      newProjectName: $newProjectName
    }
  ) {
    inserted
    project {
      name
    }
  }
}

mutation UpsertRegistry(
  $description: String
  $entityName: String
  $name: String
  $access: String
  $allowAllArtifactTypesInRegistry: Boolean
  $artifactTypes: [ArtifactTypeInput!]
) {
  upsertModel(
    input: {
      description: $description
      entityName: $entityName
      name: $name
      access: $access
      allowAllArtifactTypesInRegistry: $allowAllArtifactTypesInRegistry
      artifactTypes: $artifactTypes
    }
  ) {
    inserted
    project {
      ...RegistryFragment
    }
  }
}

mutation DeleteRegistry($id: String!) {
  deleteModel(input: { id: $id }) {
    success
  }
}
