fragment ArtifactCollectionFragment on ArtifactCollection {
  __typename
  id
  name
  description
  createdAt
  project {
    ...ProjectInfoFragment
  }
  defaultArtifactType {
    name
  }
  tags {
    edges {
      node {
        ...TagFragment
      }
    }
  }
  aliases(after: $aliasesCursor, first: $aliasesPerPage) @include(if: $includeAliases) {
    edges {
      node {
        ...ArtifactAliasFragment
      }
    }
  }
}

# A smaller fragment on ArtifactCollection that only includes minimal descriptive fields.
fragment ArtifactCollectionSummary on ArtifactCollection {
  __typename
  id
  name
  description
  createdAt
}

mutation DeleteArtifactSequence($id: ID!) {
  deleteArtifactSequence(input: { artifactSequenceID: $id }) {
    artifactCollection {
      state
    }
  }
}

mutation DeleteArtifactPortfolio($id: ID!) {
  deleteArtifactPortfolio(input: { artifactPortfolioID: $id }) {
    artifactCollection {
      state
    }
  }
}

mutation UpdateArtifactSequence($input: UpdateArtifactSequenceInput!) {
  updateArtifactSequence(input: $input) {
    artifactCollection {
      ...ArtifactCollectionSummary
    }
  }
}

mutation UpdateArtifactPortfolio($input: UpdateArtifactPortfolioInput!) {
  updateArtifactPortfolio(input: $input) {
    artifactCollection {
      ...ArtifactCollectionSummary
    }
  }
}

mutation UpdateArtifactCollectionType($input: MoveArtifactSequenceInput!) {
  moveArtifactSequence(input: $input) {
    artifactCollection {
      ...ArtifactCollectionSummary
    }
  }
}

mutation AddArtifactCollectionTags($input: CreateArtifactCollectionTagAssignmentsInput!) {
  createArtifactCollectionTagAssignments(input: $input) {
    tags {
      ...TagFragment
    }
  }
}

mutation DeleteArtifactCollectionTags($input: DeleteArtifactCollectionTagAssignmentsInput!) {
  deleteArtifactCollectionTagAssignments(input: $input) {
    success
  }
}

query ProjectArtifactCollections(
  $entity: String!
  $project: String!
  $artifactType: String!
  $cursor: String
  $aliasesCursor: String
  $aliasesPerPage: Int = 0
  $includeAliases: Boolean = false
) {
  project(name: $project, entityName: $entity) {
    artifactType(name: $artifactType) {
      # NOTE: The node being aliased is named:
      # - `artifactCollections` for new servers
      # - `artifactSequences` for old servers
      artifactCollections: artifactCollections(after: $cursor) {
        totalCount
        pageInfo {
          ...PageInfoFragment
        }
        edges {
          node {
            ...ArtifactCollectionFragment
          }
        }
      }
    }
  }
}

query ProjectArtifactCollection(
  $entity: String!
  $project: String!
  $artifactType: String!
  $name: String!
  $aliasesCursor: String
  $aliasesPerPage: Int = 1000
  $includeAliases: Boolean = true
) {
  project(name: $project, entityName: $entity) {
    artifactType(name: $artifactType) {
      # NOTE: The node being aliased is named:
      # - `artifactCollection` for new servers
      # - `artifactSequence` for old servers
      artifactCollection: artifactCollection(name: $name) {
        ...ArtifactCollectionFragment
      }
    }
  }
}

fragment ArtifactPortfolioTypeFields on ArtifactPortfolio {
  __typename
  id
  name
}

fragment ArtifactSequenceTypeFields on ArtifactSequence {
  __typename
  id
  name
}
