fragment AnyTriggerEventDetailsFields on TriggerEventDetails {
  ... on ArtifactEventDetails {
    artifactMetadata
    artifactVersionIndex
    artifactCollectionName
    projectName
    entityName
  }
  ... on ArtifactAliasEventDetails {
    artifactMetadata
    artifactVersionIndex
    artifactCollectionName
    projectName
    entityName
    alias
  }
  ... on ArtifactTagEventDetails {
    artifactMetadata
    artifactVersionIndex
    artifactCollectionName
    projectName
    entityName
    tag
  }
  ... on RunMetricEventDetails {
    runName
    projectName
    entityName
    metricName
    metricValues
  }
  ... on RunStateEventDetails {
    runName
    projectName
    entityName
    newRunState
  }
}

fragment AnyTriggerActionDetailsFields on TriggerActionDetails {
  ... on QueueJobActionArgs {
    runSpec
    priority
  }
  ... on SlackNotificationActionArgs {
    integration {
      ...SlackIntegrationFields
    }
    title
    text
    severity
    titleURL
  }
  ... on GenericWebhookActionArgs {
    integration {
      ...WebhookIntegrationFields
    }
    requestPayload
  }
  ... on NoOpActionArgs {
    noOp
  }
}

fragment AnyTriggerResultDetailsFields on TriggerResultDetails {
  ... on DefaultTriggerResultDetails {
    error {
      message
    }
  }
  ... on HttpTriggerResultDetails {
    error {
      message
    }
    status
    statusCode
    body
  }
  ... on QueuedJobTriggerResultDetails {
    error {
      message
    }
    runQueueItemID
  }
}

fragment TriggerExecutionFields on TriggerExecution {
  __typename
  id
  automationID: triggerID
  automationName: triggerName
  triggeredAt: createdAt
  state
  scope {
    ...AnyTriggerScopeFields
  }
  event {
    eventType
    data {
      ...AnyTriggerEventDetailsFields
    }
  }
  action {
    actionType
    data {
      ...AnyTriggerActionDetailsFields
    }
  }
  result {
    resultType
    data {
      ...AnyTriggerResultDetailsFields
    }
  }
}

query GetAutomationHistory($id: ID!, $cursor: String, $perPage: Int) {
  triggerExecutions(triggerID: $id, after: $cursor, first: $perPage) {
    totalCount
    pageInfo {
      ...PageInfoFields
    }
    edges {
      node {
        ...TriggerExecutionFields
      }
    }
  }
}

query GetProjectAutomationHistory(
  $project: String!
  $entity: String!
  $cursor: String
  $perPage: Int
  $projectOnly: Boolean = false
) {
  scope: project(name: $project, entityName: $entity) {
    triggerExecutions(projectOnly: $projectOnly, after: $cursor, first: $perPage) {
      totalCount
      pageInfo {
        ...PageInfoFields
      }
      edges {
        node {
          ...TriggerExecutionFields
        }
      }
    }
  }
}

query GetCollectionAutomationHistory($id: ID!, $cursor: String, $perPage: Int) {
  scope: artifactCollection(id: $id) {
    triggerExecutions(after: $cursor, first: $perPage) {
      totalCount
      pageInfo {
        ...PageInfoFields
      }
      edges {
        node {
          ...TriggerExecutionFields
        }
      }
    }
  }
}
